<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arabic Canvas Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        canvas {
            border: 1px solid #ddd;
            display: block;
            margin: 20px auto;
        }
        .test-text {
            text-align: right;
            direction: rtl;
            padding: 10px;
            border: 1px solid #ccc;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Arabic Canvas Rendering Test</h1>
        
        <h2>Test 1: HTML Rendering (should work)</h2>
        <div class="test-text">
            <strong>متجر عينة</strong><br>
            123 شارع الرئيسي<br>
            تفاح - موز - برتقال<br>
            شكراً لك على الشراء!<br>
            نتمنى رؤيتك مرة أخرى
        </div>

        <h2>Test 2: Canvas Rendering</h2>
        <button onclick="drawArabicOnCanvas()">Draw on Canvas</button>
        <canvas id="testCanvas" width="576" height="400"></canvas>

        <div id="output" style="margin-top: 20px; padding: 10px; background: #f9f9f9; border-radius: 4px;"></div>
    </div>

    <script>
        function drawArabicOnCanvas() {
            const canvas = document.getElementById('testCanvas');
            const ctx = canvas.getContext('2d');
            const output = document.getElementById('output');
            
            // Clear canvas
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Setup text
            ctx.fillStyle = '#000000';
            ctx.textAlign = 'right';
            
            let y = 40;
            const rightX = canvas.width - 40;
            
            // Test different fonts
            const arabicTexts = [
                'متجر عينة',
                '123 شارع الرئيسي',
                'تفاح',
                'موز',
                'برتقال',
                'شكراً لك على الشراء!',
                'نتمنى رؤيتك مرة أخرى'
            ];
            
            const fonts = [
                'bold 24px "Segoe UI"',
                '18px "Segoe UI"',
                'bold 20px Tahoma',
                '16px Arial',
                'bold 18px "Traditional Arabic"',
                '16px "Simplified Arabic"',
                'bold 20px sans-serif'
            ];
            
            output.innerHTML = '<h3>Drawing Results:</h3>';
            
            arabicTexts.forEach((text, i) => {
                const font = fonts[i % fonts.length];
                ctx.font = font;
                ctx.fillText(text, rightX, y);
                
                // Measure text
                const metrics = ctx.measureText(text);
                output.innerHTML += `<p><strong>${text}</strong> with ${font}<br>Width: ${metrics.width}px</p>`;
                
                y += 45;
            });
            
            output.innerHTML += '<p style="color: green; font-weight: bold;">✅ Canvas drawn! If you see boxes or gibberish above, it means the font doesn\'t support Arabic.</p>';
            
            // Add visual debug
            ctx.strokeStyle = 'red';
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(rightX, 0);
            ctx.lineTo(rightX, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Save to desktop simulation
            const dataUrl = canvas.toDataURL('image/png');
            output.innerHTML += `<p>Data URL length: ${dataUrl.length} characters</p>`;
            output.innerHTML += `<a href="${dataUrl}" download="test-receipt.png" style="display: inline-block; margin-top: 10px; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 4px;">Download Test Image</a>`;
        }
        
        // Auto-draw on load
        window.addEventListener('load', drawArabicOnCanvas);
    </script>
</body>
</html>
